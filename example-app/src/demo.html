<!doctype html>
<html lang="en" dir="ltr">
  <head>
    <meta charset="UTF-8" />
    <title>Native Clipboard Demo</title>
    <meta
      name="viewport"
      content="viewport-fit=cover, width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no"
    />
    <meta name="format-detection" content="telephone=no" />
    <meta name="msapplication-tap-highlight" content="no" />

    <link rel="icon" type="image/x-icon" href="./assets/icon/favicon.ico" />
    <link rel="manifest" href="./manifest.json" />
    <meta name="theme-color" content="#31d53d" />
    
    <style>
      * {
        box-sizing: border-box;
      }
      
      body {
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
        margin: 0;
        padding: 20px;
        background: #f5f5f5;
      }
      
      .container {
        max-width: 800px;
        margin: 0 auto;
        background: white;
        padding: 30px;
        border-radius: 12px;
        box-shadow: 0 2px 10px rgba(0,0,0,0.1);
      }
      
      h1 {
        color: #333;
        margin-top: 0;
      }
      
      .demo-section {
        margin: 30px 0;
      }
      
      .demo-section h2 {
        color: #555;
        font-size: 18px;
        margin-bottom: 10px;
      }
      
      textarea {
        width: 100%;
        min-height: 150px;
        padding: 15px;
        font-size: 16px;
        border: 2px solid #ddd;
        border-radius: 8px;
        resize: vertical;
        font-family: inherit;
        transition: border-color 0.3s;
      }
      
      textarea:focus {
        outline: none;
        border-color: #31d53d;
      }
      
      .instructions {
        background: #e8f5e9;
        border-left: 4px solid #31d53d;
        padding: 15px;
        margin: 20px 0;
        border-radius: 4px;
      }
      
      .instructions p {
        margin: 5px 0;
        color: #2e7d32;
      }
      
      .event-log {
        background: #f5f5f5;
        border: 1px solid #ddd;
        border-radius: 8px;
        padding: 15px;
        max-height: 200px;
        overflow-y: auto;
        font-family: 'Courier New', monospace;
        font-size: 14px;
      }
      
      .event-item {
        padding: 5px 0;
        border-bottom: 1px solid #e0e0e0;
      }
      
      .event-item:last-child {
        border-bottom: none;
      }
      
      .event-action {
        font-weight: bold;
        color: #31d53d;
      }
      
      .event-copy {
        color: #1976d2;
      }
      
      .event-paste {
        color: #f57c00;
      }
      
      .clear-button {
        background: #31d53d;
        color: white;
        border: none;
        padding: 10px 20px;
        border-radius: 6px;
        cursor: pointer;
        font-size: 14px;
        margin-top: 10px;
      }
      
      .clear-button:hover {
        background: #28a73d;
      }
      
      .status {
        color: #666;
        font-size: 14px;
        margin-top: 10px;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>ðŸ“‹ Native Clipboard Demo</h1>
      
      <div class="instructions">
        <p><strong>Instructions:</strong></p>
        <p>1. Right-click (or long press on mobile) anywhere in the text area</p>
        <p>2. Select from Copy, Cut, Paste, or Select All options</p>
        <p>3. Watch the event log to see clipboard actions in real-time</p>
      </div>
      
      <div class="demo-section">
        <h2>Text Area with Native Context Menu</h2>
        <textarea 
          id="demo-textarea" 
          placeholder="Right-click or long-press to show the native context menu...&#10;&#10;Try selecting some text and copying/cutting it, or paste content from your clipboard!"
        ></textarea>
        <div class="status" id="status">Ready - Right-click to test!</div>
      </div>
      
      <div class="demo-section">
        <h2>Event Log</h2>
        <div class="event-log" id="event-log">
          <div style="color: #999;">Waiting for clipboard events...</div>
        </div>
        <button class="clear-button" id="clear-log">Clear Log</button>
      </div>
    </div>

    <script type="module">
      import { NativeClipboard } from '../dist/esm/index.js';
      
      const textarea = document.getElementById('demo-textarea');
      const eventLog = document.getElementById('event-log');
      const statusDiv = document.getElementById('status');
      const clearButton = document.getElementById('clear-log');
      
      let eventCount = 0;
      
      function logEvent(action, data) {
        eventCount++;
        const item = document.createElement('div');
        item.className = 'event-item';
        
        const timestamp = new Date().toLocaleTimeString();
        const actionClass = action === 'copy' ? 'event-copy' : 
                           action === 'cut' ? 'event-copy' : 'event-paste';
        
        let message = `<span class="event-action ${actionClass}">[${timestamp}] ${action.toUpperCase()}</span>`;
        
        if ((action === 'copy' || action === 'cut') && data.selectedText) {
          message += ` - Text: "${data.selectedText.substring(0, 50)}${data.selectedText.length > 50 ? '...' : ''}"`;
        } else if (action === 'paste' && data.text) {
          message += ` - Pasted: "${data.text.substring(0, 50)}${data.text.length > 50 ? '...' : ''}"`;
        }
        
        item.innerHTML = message;
        
        if (eventLog.firstChild && eventLog.firstChild.style.color === 'rgb(153, 153, 153)') {
          eventLog.innerHTML = '';
        }
        
        eventLog.insertBefore(item, eventLog.firstChild);
        
        // Keep only last 20 events
        while (eventLog.children.length > 20) {
          eventLog.removeChild(eventLog.lastChild);
        }
      }
      
      function updateStatus(message, color = '#666') {
        statusDiv.textContent = message;
        statusDiv.style.color = color;
      }
      
      async function init() {
        try {
          // Enable the native context menu
          await NativeClipboard.enableContextMenu({
            enableCopy: true,
            enablePaste: true,
            enableCut: true,
            enableSelectAll: true
          });
          
          updateStatus('âœ“ Native context menu enabled successfully', '#31d53d');
          
          // Add clipboard event listener
          const listener = await NativeClipboard.addListener('clipboardMenuAction', (event) => {
            console.log('Clipboard event:', event);
            
            switch (event.action) {
              case 'copy':
                logEvent('copy', event);
                updateStatus(`âœ“ Copied: "${event.selectedText?.substring(0, 30)}..."`, '#1976d2');
                break;
                
              case 'cut':
                logEvent('cut', event);
                updateStatus(`âœ“ Cut: "${event.selectedText?.substring(0, 30)}..."`, '#1976d2');
                
                // Remove selected text from textarea
                const start = textarea.selectionStart || 0;
                const end = textarea.selectionEnd || 0;
                textarea.value = 
                  textarea.value.substring(0, start) + 
                  textarea.value.substring(end);
                textarea.setSelectionRange(start, start);
                textarea.focus();
                break;
                
              case 'paste':
                logEvent('paste', event);
                
                // Insert pasted text at cursor position
                const pasteStart = textarea.selectionStart || 0;
                const pasteEnd = textarea.selectionEnd || 0;
                const currentValue = textarea.value;
                
                textarea.value = 
                  currentValue.substring(0, pasteStart) + 
                  event.text + 
                  currentValue.substring(pasteEnd);
                
                // Update cursor position
                const newPosition = pasteStart + event.text.length;
                textarea.setSelectionRange(newPosition, newPosition);
                textarea.focus();
                
                updateStatus(`âœ“ Pasted: "${event.text?.substring(0, 30)}..."`, '#f57c00');
                break;
                
              case 'selectAll':
                logEvent('selectAll', event);
                textarea.select();
                updateStatus('âœ“ Selected all text', '#9c27b0');
                break;
            }
          });
          
          console.log('Native Clipboard initialized successfully');
        } catch (error) {
          console.error('Error initializing clipboard:', error);
          updateStatus('âœ— Error initializing - see console', '#d32f2f');
        }
      }
      
      // Clear log button
      clearButton.addEventListener('click', () => {
        eventLog.innerHTML = '<div style="color: #999;">Event log cleared</div>';
        eventCount = 0;
      });
      
      // Initialize on load
      init();
    </script>
  </body>
</html>
